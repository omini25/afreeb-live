(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2222],{5248:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return t(5001)}])},479:function(e,s,t){"use strict";var a=t(5893),r=t(7294),c=t(1190),l=t(7066),d=t(8787),n=t(2920);s.Z=function(e){let{userId:s,refreshAddresses:t}=e,[i,o]=(0,r.useState)(!1),u=()=>{o(!1)},[m,h]=(0,r.useState)(""),p=async e=>{e.preventDefault();let a={country:e.target.elements.country.value,address:e.target.elements.address.value,street:e.target.elements.street.value,city:e.target.elements.city.value,state:e.target.elements.state.value,zip_code:e.target.elements.zip_code.value};try{let e=await l.Z.post("".concat(d.f,"/address/").concat(s),a);console.log(e.data),u(),201===e.status&&(n.Am.success("Address added successfully."),onAddressAdded()),t()}catch(e){console.error("Failed to add address:",e)}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("button",{className:"btn btn-sm font-weight-bold text-white mt-10 border-radius-5 btn-shadow-brand hover-up",onClick:()=>{o(!0)},children:"Add Address"}),(0,a.jsxs)(c.Z,{open:i,onClose:u,center:!0,styles:{modal:{width:"80%"}},children:[(0,a.jsx)("h2",{className:"p-4",children:"Add Address"}),(0,a.jsxs)("form",{className:"p-4",onSubmit:p,children:[(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{type:"text",name:"country",required:"",placeholder:"Country *"})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{type:"text",name:"address",required:"",placeholder:"Address *"})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{required:"",type:"text",name:"street",placeholder:"Street *"})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{required:"",type:"text",name:"city",placeholder:"City / Town *"})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{required:"",type:"text",name:"state",placeholder:"State / County *"})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{required:"",type:"text",name:"zip_code",placeholder:"Postcode / ZIP *"})}),(0,a.jsx)("div",{className:"col-lg-12 col-md-12",children:(0,a.jsx)("button",{className:"submit submit-auto-width",type:"submit",children:"Add Address"})})]})]})]})})}},8787:function(e,s,t){"use strict";t.d(s,{f:function(){return a}});let a="https://api.afreebmart.com/api"},5001:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var a=t(5893),r=t(2664),c=t(9583),l=t(8866),d=t(1316),n=t(7294),i=t(2920),o=t(1163),u=t(2859),m=t(7066),h=t(8787);t(6664);var p=t(47),x=t(479);let j={closeCart:l.Ee,increaseQuantity:l.Qd,decreaseQuantity:l.a3,deleteFromCart:l.EI,openCart:l.LA,clearCart:l.LL};var g=(0,r.$j)(e=>({cartItems:e.cart,activeCart:e.counter}),j)(e=>{let{openCart:s,cartItems:t,activeCart:r,closeCart:l,increaseQuantity:j,decreaseQuantity:g,deleteFromCart:f,clearCart:y}=e,v=(0,p.ac)({query:"(max-width: 767px)"}),[b,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=window.matchMedia("(min-width: 768px)").matches;N(e)},[]);let w=()=>{let e=0;return t.forEach(s=>{e+=s.price*s.quantity}),e=Math.round(100*e)/100},A=(0,o.useRouter)(),[C,S]=(0,n.useState)(null),[_,k]=(0,n.useState)([]),P=JSON.parse(localStorage.getItem("userInfo")),q=P?P.user.id:null,[E,F]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=async()=>{try{let e=await m.Z.get("".concat(h.f,"/address/").concat(P.user.id));k(e.data.address)}catch(e){console.error("Failed to fetch addresses:",e)}};e()},[]),(0,n.useEffect)(()=>{let e=async()=>{try{let e=JSON.parse(localStorage.getItem("userInfo")),s=await m.Z.get("".concat(h.f,"/address/").concat(e.user.id)),t=s.data.address.find(e=>1===e.is_default);S(t)}catch(e){console.error("Failed to fetch address:",e)}};e()},[]);let I=async()=>{try{let e=await m.Z.get("".concat(h.f,"/address/").concat(q));k(e.data.address)}catch(e){console.error("Failed to refresh addresses:",e)}},[Z,D]=(0,n.useState)(""),[L,T]=(0,n.useState)({country:"",address:"",address2:"",city:"",state:"",zipcode:""}),O=e=>{let{name:s,value:t}=e.target;T(e=>({...e,[s]:t}))},[U,z]=(0,n.useState)(!1),[J,Q]=(0,n.useState)(0),$=(w()+5.99+J).toFixed(2);(0,n.useEffect)(()=>{let e=localStorage.getItem("isLoggedIn");e||(A.push("/login"),(0,i.Am)("You need to login to access this page!"))},[]);let M=(0,u.J)("pk_test_51K4bVzCT7v0Ax3ZCQUKpDk4gTPZ6UuWcJlMpNULOujrGRhsEL4IPAdeZ7KwDXIFEcJ5sLTxm3r2DMCUaQYWbLl2W00W13HDVPl"),R=async e=>{if(e.preventDefault(),!Z){i.Am.error("Please select a shipping address.");return}if(!U){let e=Object.values(L).every(e=>""!==e.trim());if(!e){i.Am.error("Please complete all billing address fields.");return}}try{e.preventDefault();let s=t.map(e=>({name:e.product_name,totalPrice:e.price,quantity:e.quantity,image:e.image,tip:e.tip})),a=JSON.parse(localStorage.getItem("userInfo"));console.log(s),await M;let r=await m.Z.post("".concat(h.f,"/create-checkout-session"),{productDetails:s,user_id:a.user.id,total:$,tip:J}),{id:c,url:l}=r.data;l?window.location.href=l:i.Am.error("Failed to create a checkout session.")}catch(e){console.error("An error occurred:",e),i.Am.error("An error occurred during the payment process.")}};(0,n.useEffect)(()=>{let e=new URLSearchParams(window.location.search),s=e.get("session_id"),t=e.get("status");s?W(s):"cancelled"===t&&i.Am.error("Payment was cancelled. Please try again.")},[]);let W=async e=>{try{let s=await m.Z.get("".concat(h.f,"/verify-payment?session_id=").concat(e));"success"===s.data.status?(i.Am.success("Payment successful!"),y(),navigate("/order-successful")):(i.Am.error("Payment was not successful. Please try again."),navigate("/checkout"))}catch(e){console.error("Error verifying payment:",e),i.Am.error("An error occurred while verifying the payment."),navigate("/checkout")}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(c.Z,{parent:"Home",sub:"Shop",subChild:"Checkout",children:(0,a.jsx)("section",{className:"mt-50 mb-50 ".concat(b?'style={{paddingLeft: "70px", paddingRight: "70px"}}':""),children:(0,a.jsxs)("div",{className:"container",children:[(0,a.jsx)("div",{className:"row",children:(0,a.jsxs)("div",{className:"col-lg-8 mb-40",children:[(0,a.jsx)("h1",{className:"heading-2 mb-10",children:"Checkout"}),(0,a.jsx)("div",{className:"d-flex justify-content-between",children:(0,a.jsxs)("h6",{className:"text-body",children:["There are"," ",(0,a.jsx)("span",{className:"text-brand",children:t.length})," ","products in your cart"]})})]})}),(0,a.jsxs)("div",{className:"row",children:[(0,a.jsxs)("div",{className:"col-lg-7",children:[(0,a.jsx)("div",{className:"row mb-50",children:(0,a.jsx)("div",{className:"col-lg-8",children:(0,a.jsxs)("form",{method:"post",className:"apply-coupon",children:[(0,a.jsx)("input",{type:"text",placeholder:"Enter Coupon Code..."}),(0,a.jsx)("button",{className:"btn  btn-md",children:"Apply Coupon"})]})})}),(0,a.jsx)("div",{className:"mb-25",children:(0,a.jsx)("h4",{children:"Shipping Details"})}),(0,a.jsxs)("select",{value:Z,onChange:e=>{D(e.target.value)},children:[(0,a.jsx)("option",{value:"",children:"Select Address"}),_.map((e,s)=>(0,a.jsxs)("option",{value:e.id,children:[e.street,", ",e.city,", ",e.state,", ",e.country,", ",e.zip_code]},s))]}),(0,a.jsx)(x.Z,{userId:q,onAddressAdded:I}),(0,a.jsx)("div",{className:"mb-25 mt-30",children:(0,a.jsx)("h4",{children:"Billing Details"})}),_?(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"chek-form",children:(0,a.jsxs)("div",{className:"custome-checkbox pb-15",children:[(0,a.jsx)("input",{className:"form-check-input",type:"checkbox",name:"checkbox",id:"differentaddress",onChange:()=>z(!U)}),(0,a.jsx)("label",{className:"form-check-label label_info","data-bs-toggle":"collapse","data-target":"#collapseAddress",href:"#collapseAddress","aria-controls":"collapseAddress",htmlFor:"differentaddress",children:(0,a.jsx)("span",{children:"Use Shipping Address for Billing"})})]})})}):null,!U&&(0,a.jsxs)("form",{method:"post",children:[(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("div",{className:"custom_select",children:(0,a.jsxs)("select",{className:"form-control select-active",name:"country",value:L.country,onChange:O,children:[(0,a.jsx)("option",{value:"",children:"Select an option..."}),(0,a.jsx)("option",{value:"US",children:"USA (US)"})]})})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{type:"text",name:"address",required:"",placeholder:"Address *",value:L.address,onChange:O})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{type:"text",name:"address2",required:"",placeholder:"Address line2",value:L.address2,onChange:O})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{required:"",type:"text",name:"city",placeholder:"City / Town *",value:L.city,onChange:O})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{required:"",type:"text",name:"state",placeholder:"State / County *",value:L.state,onChange:O})}),(0,a.jsx)("div",{className:"form-group",children:(0,a.jsx)("input",{required:"",type:"text",name:"zipcode",placeholder:"Postcode / ZIP *",value:L.zipcode,onChange:O})})]})]}),(0,a.jsx)("div",{className:"col-lg-5",children:(0,a.jsxs)("div",{className:"border p-40 cart-totals ml-30 mb-50",children:[(0,a.jsxs)("div",{className:"d-flex align-items-end justify-content-between mb-30",children:[(0,a.jsx)("h4",{children:"Your Order"}),(0,a.jsx)("h6",{className:"text-muted",children:"Subtotal"})]}),(0,a.jsx)("div",{className:"divider-2 mb-30"}),(0,a.jsxs)("div",{className:"table-responsive order_table",children:[t&&t.length<=0&&"No Products",(0,a.jsx)("table",{className:t&&t.length>0?"table no-border":"d-none",children:(0,a.jsx)("tbody",{children:t&&t.map((e,s)=>(0,a.jsxs)("tr",{style:v?{display:"flex",flexDirection:"row"}:{},children:[(0,a.jsx)("td",{className:"",children:(0,a.jsx)("img",{src:"".concat(d.j,"/images/products/").concat(e.image),alt:"#",style:v?{width:"200%",height:"auto"}:{}})}),(0,a.jsx)("td",{children:(0,a.jsx)("h6",{className:"w-160 mb-5",children:(0,a.jsx)("a",{children:e.product_name})})}),(0,a.jsx)("td",{children:(0,a.jsxs)("h6",{className:"text-muted pl-20 pr-20",children:["x"," ",e.quantity]})}),(0,a.jsxs)("td",{children:[(0,a.jsxs)("h4",{className:"text-brand",style:{display:"none","@media (min-width: 768px)":{display:"block"}},children:["$",(e.quantity*e.price).toFixed(2)]}),(0,a.jsxs)("h5",{className:"text-brand",style:{display:"block","@media (min-width: 768px)":{display:"none"}},children:["$",(e.quantity*e.price).toFixed(2)]})]})]},s))})})]}),(0,a.jsx)("div",{className:"bt-1 border-color-1 mt-30 mb-30"}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"tip",children:"Delivery Tip:"}),(0,a.jsx)("input",{type:"number",id:"tip",name:"tip",min:"0",step:"0.01",value:J,onChange:e=>Q(parseFloat(e.target.value))})]}),(0,a.jsxs)("div",{className:"payment_method",children:[(0,a.jsx)("div",{className:"mb-25",children:(0,a.jsx)("h5",{children:"Shipping: $5.99"})}),(0,a.jsx)("div",{className:"mb-25",children:(0,a.jsxs)("h5",{children:["Total Payment: $",(w()+5.99+(isNaN(J)?0:J)).toFixed(2)]})})]}),(0,a.jsx)("button",{className:"btn btn-fill-out btn-block mt-30",onClick:R,children:"Place Order"})]})})]})]})})})})})}},function(e){e.O(0,[1664,4143,1001,8491,9583,9774,2888,179],function(){return e(e.s=5248)}),_N_E=e.O()}]);